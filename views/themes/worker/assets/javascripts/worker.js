"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(r){return typeof r}:function(r){return r&&"function"==typeof Symbol&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r};!function(r){"function"==typeof define&&define.amd?define(["jquery"],r):r("object"===("undefined"==typeof exports?"undefined":_typeof(exports))?require("jquery"):jQuery)}(function(r){function e(o,t){this.$element=r(o),this.options=r.extend({},e.DEFAULTS,r.isPlainObject(t)&&t),this.init()}return e.prototype={constructor:e,init:function(){this.bind(),this.formOpened=!1,r(".qor-worker-form--show").length&&(this.formOpened=!0),r(".qor-slideout").is(":visible")||r.fn.qorSliderAfterShow.updateWorkerProgress()},bind:function(){this.$element.on("click.qor.worker",".qor-worker--new",r.proxy(this.showForm,this)).on("click.qor.worker",".qor-button--back",r.proxy(this.hideForm,this))},unbind:function(){this.$element.off("click.qor.worker",".qor-worker--new",this.showForm,this).off("click.qor.worker",".qor-button--back",this.hideForm,this)},hideForm:function(e){e.preventDefault(),this.$element.find(".qor-worker-form").find(">li").show().removeClass("current").find("form").addClass("hidden"),r(".qor-button--back").addClass("hidden"),r(".qor-worker-form-list").show(),this.formOpened=!1,window.onbeforeunload=null,r.fn.qorSlideoutBeforeHide=null},showForm:function(e){var o=r(e.target);if(e.preventDefault(),!this.formOpened){var t=o.closest("li"),s=o.closest(".qor-worker-form"),n=o.closest(".qor-worker-form-list");s.find(">li").hide().removeClass("current"),t.addClass("current").show(),r(".qor-button--back").removeClass("hidden"),t.find(".qor-worker-form-list").hide(),n.show().find("form").removeClass("hidden"),this.formOpened=!0}},destroy:function(){this.unbind(),e.getWorkerProgressIntervId&&window.clearInterval(e.getWorkerProgressIntervId)}},e.DEFAULTS={},e.POPOVERTEMPLATE='<div class="qor-modal fade qor-modal--worker-errors" tabindex="-1" role="dialog" aria-hidden="true">\n          <div class="mdl-card mdl-shadow--2dp" role="document">\n            <div class="mdl-card__title">\n              <h2 class="mdl-card__title-text">Process Errors</h2>\n            </div>\n          <div class="mdl-card__supporting-text" id="qor-worker-errors"></div>\n            <div class="mdl-card__actions">\n              <a class="mdl-button mdl-button--colored mdl-js-button mdl-js-ripple-effect" data-dismiss="modal">close</a>\n            </div>\n          </div>\n        </div>',e.plugin=function(o){return this.each(function(){var t,s=r(this),n=s.data("qor.worker");if(!n){if(/destroy/.test(o))return;s.data("qor.worker",n=new e(this,o))}"string"==typeof o&&r.isFunction(t=n[o])&&t.apply(n)})},r.fn.qorSliderAfterShow.updateWorkerProgress=function(o){r(".workers-log-output").length&&(e.getWorkerProgressIntervId=window.setInterval(e.updateWorkerProgress,2e3,o))},e.updateTableStatus=function(e){var o=r(".qor-js-table").find(".is-selected"),t=r(".qor-worker--progress").data().statusName;o.find('td[data-heading="'+t+'"]').find(".qor-table__content").html(e)},e.isScrollToBottom=function(r){return r.clientHeight+r.scrollTop<=r.scrollHeight},e.updateWorkerProgress=function(o){var t=o,s=r(".workers-log-output"),n=r(".qor-worker--progress-value"),i=r(".qor-worker--progress-status"),d=r(".qor-worker--progress"),l=r(".qor-js-table").find(".is-selected"),a=["killed","exception","cancelled","scheduled"];if(s.length){if(d.length)var u=d.data();if(l.length&&u&&u.statusName)var c=l.find('td[data-heading="'+u.statusName+'"]').find(".qor-table__content").html();return d.length&&d.length&&-1==a.indexOf(u.status)?u.progress>=100?(window.clearInterval(e.getWorkerProgressIntervId),document.querySelector("#qor-worker--progress").MaterialProgress.setProgress(100),e.updateTableStatus(u.status),r(".qor-workers-abort").addClass("hidden"),void r(".qor-workers-rerun").removeClass("hidden")):void r.ajax({url:t,method:"GET",dataType:"html",processData:!1,contentType:!1}).done(function(o){var t=r(o),d=t.find(".qor-worker--progress").data(),l=d.progress,a=d.status;n.html(l),i.html(a),document.querySelector("#qor-worker--progress").MaterialProgress.setProgress(l);var u=r.trim(s.html()),f=r.trim(t.find(".workers-log-output").html()),h=void 0,m=t.find(".workers-error-output");f!=u&&(h=f.replace(u,""),e.isScrollToBottom(s[0])?s.append(h).scrollTop(s[0].scrollHeight):s.append(h)),m.length&&r(".workers-error-output").html(m.html()),c!=a&&e.updateTableStatus(a),l>=100&&(window.clearInterval(e.getWorkerProgressIntervId),r(".qor-workers-abort").addClass("hidden"),r(".qor-workers-rerun").removeClass("hidden"),r(".qor-worker--progress-result").html(t.find(".qor-worker--progress-result").html()))}):void window.clearInterval(e.getWorkerProgressIntervId)}},r(function(){var o='[data-toggle="qor.workers"]';r(document).on("disable.qor.worker",function(t){e.plugin.call(r(o,t.target),"destroy")}).on("enable.qor.worker",function(t){e.plugin.call(r(o,t.target))}).triggerHandler("enable.qor.worker")}),e});